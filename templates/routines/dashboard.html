{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}


{% block title %}My Routines - SKYN{% endblock %}


{% block content %}
<div class="dashboard-container">

  <!-- Header -->
  <h1 class="page-title">Your Dashboard</h1>
  
  <!-- Progress Section -->
  <section class="progress-section">
    <div class="progress-cards">
      <div class="progress-card">
        <h4>Today's Progress</h4>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 75%"></div>
        </div>
        <span class="progress-text">3 of 4 steps completed</span>
      </div>
      <div class="progress-card">
        <h4>Current Streak</h4>
        <div class="streak-counter">🔥 7 days</div>
      </div>
      <div class="progress-card">
        <h4>This Week</h4>
        <div class="week-progress">
          <span class="week-day completed">M</span>
          <span class="week-day completed">T</span>
          <span class="week-day completed">W</span>
          <span class="week-day current">T</span>
          <span class="week-day">F</span>
          <span class="week-day">S</span>
          <span class="week-day">S</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Routines Section -->
  <section class="routines-section">
    <h2 class="section-title">Your Routines</h2>
    <div class="routine-cards">
      <!-- Morning Routine -->
      <div class="routine-card morning">
        <div class="routine-header">
          <h3>Morning Routine</h3>
          {% if morning_routine %}
            <a href="{% url 'routines:detail' morning_routine.pk %}" class="edit-btn"> Edit</a>
          {% else %}
            <button class="edit-btn" disabled style="opacity: 0.5;"> Edit</button>
          {% endif %}
        </div>
        {% if morning_routine %}
          <ul>
            {% for step in morning_routine.steps.all %}
              <li>{{ step.product.name }} – {{ step.step_type }}</li>
            {% endfor %}
          </ul>
          <div class="routine-actions">
            <button class="complete-btn"> Mark Complete</button>
          </div>
        {% else %}
          <p>No morning routine yet.</p>
          <button class="add-routine-btn">➕ Add Morning Routine</button>
        {% endif %}
      </div>

      <!-- Evening Routine -->
      <div class="routine-card evening">
        <div class="routine-header">
          <h3>Evening Routine</h3>
          {% if evening_routine %}
            <a href="{% url 'routines:detail' evening_routine.pk %}" class="edit-btn"> Edit</a>
          {% else %}
            <button class="edit-btn" disabled style="opacity: 0.5;"> Edit</button>
          {% endif %}
        </div>
        {% if evening_routine %}
          <ul>
            {% for step in evening_routine.steps.all %}
              <li>{{ step.product.name }} – {{ step.step_type }}</li>
            {% endfor %}
          </ul>
          <div class="routine-actions">
            <button class="complete-btn">Mark Complete</button>
          </div>
        {% else %}
          <p>No evening routine yet.</p>
          <button class="add-routine-btn">➕ Add Evening Routine</button>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Tips Section -->
  <section class="dashboard-section">
    <h2 class="section-title">💡 Skincare Tips</h2>
    <div class="tips-container">
      <div class="tip-card">
        <h4>💧 Hydration Tip</h4>
        <p>Apply moisturizer to slightly damp skin to lock in extra hydration.</p>
      </div>
      <div class="tip-card">
        <h4>🌙 Evening Care</h4>
        <p>Remove makeup thoroughly before starting your evening routine for best results.</p>
      </div>
      <div class="tip-card">
        <h4>☀️ Morning Protection</h4>
        <p>Always finish your morning routine with SPF, even on cloudy days.</p>
      </div>
      <div class="tip-card">
        <h4>😴 Beauty Sleep</h4>
        <p>Get 7-8 hours of quality sleep - it's when your skin repairs and regenerates itself.</p>
      </div>
      <div class="tip-card">
        <h4>🌱 Ingredient Order</h4>
        <p>Apply thinnest to thickest consistency: serums before moisturizers, oils last.</p>
      </div>
      <div class="tip-card">
        <h4>🔄 Product Rotation</h4>
        <p>Introduce new active ingredients gradually, one at a time every 2-3 weeks.</p>
      </div>
    </div>
    <!-- Placeholder for future dynamic tips functionality -->
  </section>

  <!-- Calendar Section with isolated styling -->
  <section class="calendar-section" id="calendar-wrapper">
    <h2 class="section-title">Calendar Overview</h2>
    <div id="calendar"></div>
  </section>

</div>

{% block extra_js %}
<script>
    // Calendar initialization
    if (typeof window.ROUTINE_EVENTS === 'undefined') {
        window.ROUTINE_EVENTS = {};
    }
    try {
        window.ROUTINE_EVENTS = JSON.parse('{{ routine_events_json|default:"{}" |escapejs }}');
    } catch (e) {
        console.warn('Could not parse routine events:', e);
        window.ROUTINE_EVENTS = {};
    }
</script>
{% endblock %}

{% endblock %}
